import gitlab_module from 'gitlab'
import gitlab_module_api from 'node-gitlab-api'
import child_process from 'child_process'
import fs from 'fs'

var gitlabConfig = JSON.parse(fs.readFileSync(__dirname + '/gitlab_config.js', 'utf8'));

var gitlab = gitlab_module(
{
	url: gitlabConfig["gitlab-root"]["url"],
	token: gitlabConfig["gitlab-root"]["token"]
})


var gitlab_api = gitlab_module_api(				// NODE-GITLAB-API FTW
{
	url: gitlabConfig["gitlab-root"]["url"],
	token: gitlabConfig["gitlab-root"]["token"]
})


export default function()
{
	/*var userFullName = userInfo.firstName + " " + userInfo.lastName;
	var userInfo = 
	{
		email: userInfo.email,
		password: userInfo.password,
		username: userInfo.userID,
		name: userFullName
	}*/

	var userFullName = 'Abreeza Saleem'
	var userInfo = 
	{
		email: '18100165@lums.edu.pk',
		password: 'ex700ledbe3',
		username: 'abreeza',
		name: userFullName
	}
	createUser(userInfo)
}

function createUser(userInfo) 
{

	console.log('pls')
	/*gitlab_api.users.create(userInfo, (usr) => console.log('done'))
	gitlab_api.users.all()
	.then((projects) => 
	{
		console.log(projects)
	})*/

	console.log('gonna create user...')

	gitlab.users.create(userInfo, (usr) => 
	{
		console.log('fucking done')
		console.log(usr)
		console.log('now gonna search the fucking users')

		gitlab.users.search('18100115@lums.edu.pk', (users) => 
		{
			console.log('user is')
			console.log(users[0].username)
		})

		gitlab.users.search(userInfo.email, (users) => 
		{
			console.log('user is')
			console.log(users)
		})

		//gitlab.users.all((users) => console.log(users))

	})

	


	/*gitlab.users.create(params, (usr) => 
	{
		var key_dir = __dirname + '/keys'
		var cmd = "ssh-keygen -t rsa -N '' -f " + key_dir			////// WHAT DOES THIS DO?
		var user_id = usr.id; 
		const keyGenerator = child_process.exec(cmd, (error, stdout, stderr) => {   // generate user key-pair. Should store this in database.
			console.log("Keys Generated. Now reading Public-Key.");
			var publicKey = privateKey + ".pub";
			fs.readFile(publicKey, "utf8", (err, pubKey) => {			// read user-key				// 	WHERE IS THIS FILE STORED???? AND WHAT ARE ITS CONTENTS? 
				console.log("Public-Key ready for deployment. Now deploying on server.");
				if (err)
					console.log(err);
				gitlab.users.keys.addKey(user_id, "GitLab Public Key", pubKey, () => {  // deploying user-key
					console.log("Key deployed.");
				});
				fs.readFile(privateKey, "utf8", (err, prvKey) => {  			//// WHAT IS THE PURPOSE OF THIS FILE?
					var keys = {
						pubKey: pubKey,
						prvKey: prvKey
					};
					fs.unlink(privateKey);
					fs.unlink(publicKey);
					callback(keys);
				});
			});
		});
	});*/
}

